(executable
 (name pp)
 (modules pp)
 (libraries rmlc ppxlib))

(rule
 (targets test1b.ml)
 (deps 
  (file test1.ml))
 (action (run ./pp.exe --impl %{deps} -o %{targets})))

(rule
 (targets test2b.ml)
 (deps 
  (file test2.ml))
 (action (run ./pp.exe --impl %{deps} -o %{targets})))

(rule
 (targets test3b.ml)
 (deps 
  (file test3.ml))
 (action (run ./pp.exe --impl %{deps} -o %{targets})))

(test
 (name test2)
 (modules test2)
 (deps test1b.ml test2b.ml test3b.ml)
 (preprocess (pps rmlc))
  (action (progn
    (run ./build.sh test1b.ml test1.exe)
    (run ./build.sh test2b.ml test2.exe)
    (run ./build.sh test3b.ml test3.exe)))
)